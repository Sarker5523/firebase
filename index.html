<script>
  let allVideos = [];
  const videosPerPage = 8;
  let currentPage = 1;

  // Fetch video data from JSON
  fetch('https://raw.githubusercontent.com/Sarker5523/My-Playlists/refs/heads/main/videos.json')
    .then(response => response.json())
    .then(data => {
      allVideos = data;
      sortVideosByDate();
      displayVideos(currentPage);
      createPaginationControls();
    })
    .catch(error => console.error('Error fetching JSON:', error));

  // Sort videos by upload date in descending order
  function sortVideosByDate() {
    allVideos.sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));
  }

  // Display videos on the homepage
  function displayVideos(page) {
    const videoGrid = document.getElementById('video-grid');
    videoGrid.innerHTML = '';

    const startIndex = (page - 1) * videosPerPage;
    const endIndex = startIndex + videosPerPage;
    const videosToShow = allVideos.slice(startIndex, endIndex);

    videosToShow.forEach(video => {
      const videoItem = document.createElement('div');
      videoItem.classList.add('video-item');
      videoItem.innerHTML = `
        <a href="video.html?id=${video.id}">
          <img src="${video.thumbnail}" alt="${video.name}">
          <h3>${video.name}</h3>
        </a>
      `;
      videoGrid.appendChild(videoItem);
    });
  }

  // Create pagination controls
  function createPaginationControls() {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    const totalPages = Math.ceil(allVideos.length / videosPerPage);

    for (let i = 1; i <= totalPages; i++) {
      const button = document.createElement('button');
      button.textContent = i;
      button.onclick = () => {
        currentPage = i;
        displayVideos(currentPage);
        createPaginationControls();
      };
      if (i === currentPage) {
        button.disabled = true;
      }
      pagination.appendChild(button);
    }
  }

  // Search for videos and show suggestions
  function searchVideos(event) {
    const query = document.getElementById('search').value.toLowerCase();
    const filteredVideos = allVideos.filter(video => video.name.toLowerCase().includes(query));

    // Display search suggestions as the user types
    if (query) {
      document.getElementById('search-suggestions').style.display = 'block';
      document.getElementById('search-suggestions').innerHTML = '';
      filteredVideos.slice(0, 5).forEach(video => {
        const suggestionItem = document.createElement('div');
        suggestionItem.innerHTML = `
          <img src="${video.thumbnail}" alt="${video.name}">
          ${video.name}
        `;
        suggestionItem.onclick = () => window.location.href = `video.html?id=${video.id}`;
        document.getElementById('search-suggestions').appendChild(suggestionItem);
      });
    } else {
      document.getElementById('search-suggestions').style.display = 'none';
    }

    // Redirect to search-results page when Enter key is pressed
    if (event.key === "Enter" && filteredVideos.length > 0) {
      const queryParam = encodeURIComponent(query);
      window.location.href = `search-results.html?q=${queryParam}`;
    }
  }

  // Handle deep links for iOS Shortcuts (Custom URL Scheme)
  function handleCustomURLScheme() {
    const urlParams = new URLSearchParams(window.location.search);
    const searchQuery = urlParams.get('q'); // Fetch 'q' parameter for search queries
    if (searchQuery) {
      const query = decodeURIComponent(searchQuery);
      const filteredVideos = allVideos.filter(video => video.name.toLowerCase().includes(query));
      displayVideos(filteredVideos); // Display filtered videos based on query
    }
  }

  // Call this function on page load to handle deep links
  window.onload = function() {
    handleCustomURLScheme();
    displayVideos(currentPage);
  };
</script>